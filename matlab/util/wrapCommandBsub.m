function cmdout = wrapCommandBsub(cmdin,varargin)

[nslots,gpuqueue,logfile,jobname,additionalArgs,jobDuration] = ...
  myparse(varargin,...
          'nslots',DLBackEndClass.default_jrcnslots_train,...
          'gpuqueue',DLBackEndClass.default_jrcgpuqueue,...
          'logfile','/dev/null',...
          'jobname','', ...
          'additionalArgs','',...
		  'jobDuration',2880);
esccmd = escape_string_for_bash(cmdin) ;
if isempty(jobname),
  jobnamestr = '';
else
  jobnamestr = sprintf('-J %s', jobname) ;
end
% NB: Line below sends *both* stdout and stderr to the file named by logfile
quotedlogfile = escape_string_for_bash(logfile) ;
cmdout = sprintf('bsub -n %d -gpu "num=1" -W %d -q %s -o %s -R"affinity[core(1)]" %s %s %s',...
                 nslots,jobDuration,gpuqueue,quotedlogfile,jobnamestr,additionalArgs,esccmd);
